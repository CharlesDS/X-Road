#!/bin/bash

# Please do not change this file! It will be overwritten by updates.
# System specific changes should be added to /etc/xroad/services/local.conf

XROAD_LOG_LEVEL="INFO"

. /etc/xroad/services/global.conf

for addon in "${ADDON_PATH}"/signer/*.conf
do
 if [ -e "${addon}" ]; then
  . "${addon}"
 fi
done

CP="/usr/share/xroad/jlib/signer.jar"

# the default parameters
DEFAULT_SIGNER_PARAMS=" -Xmx50m -XX:MaxMetaspaceSize=70m \
-Dlogback.configurationFile=/etc/xroad/conf.d/signer-logback.xml "

# initial params combined with global.conf overrides (originating from local.properties)
INITIAL_SIGNER_PARAMS="$DEFAULT_SIGNER_PARAMS $XROAD_SIGNER_PARAMS"
# the new prefixed param including the default values and local.properties overrides (overridable in local.conf)
XROAD_SIGNER_PARAMS="$INITIAL_SIGNER_PARAMS"
# support for legacy params (overridable in local.conf)
SIGNER_PARAMS="$INITIAL_SIGNER_PARAMS"
# helper variable to hold the initial value
TEMP_SIGNER_PARAMS="$INITIAL_SIGNER_PARAMS"

# initial addon params to hold the original value â€“ default value already appended in hwtoken.conf
INITIAL_ADDON_PARAMS="$XROAD_ADDON_PARAMS"
# support for legacy addon params (overridable in local.conf)
ADDON_PARAMS="$INITIAL_ADDON_PARAMS"
# helper variable to hold the initial value
TEMP_ADDON_PARAMS="$INITIAL_ADDON_PARAMS"

# include legacy local modifications
if [ -f /etc/xroad/services/local.conf ]; then
  . /etc/xroad/services/local.conf
fi

# if overridden legacy $SIGNER_PARAMS originate from local.conf
if [ "$SIGNER_PARAMS" != "$INITIAL_SIGNER_PARAMS" ]; then
  TEMP_SIGNER_PARAMS="$SIGNER_PARAMS"
fi

# if overridden new $XROAD_SIGNER_PARAMS originate from local.conf (preferred)
if [ "$XROAD_SIGNER_PARAMS" != "$INITIAL_SIGNER_PARAMS" ]; then
  TEMP_SIGNER_PARAMS="$XROAD_SIGNER_PARAMS"
fi

# if overridden legacy $ADDON_PARAMS originate from local.conf
if [ "$ADDON_PARAMS" != "$INITIAL_ADDON_PARAMS" ]; then
  TEMP_ADDON_PARAMS="$ADDON_PARAMS"
fi

# if overridden new $XROAD_ADDON_PARAMS originate from local.conf (preferred)
if [ "$XROAD_ADDON_PARAMS" != "$INITIAL_ADDON_PARAMS" ]; then
  TEMP_ADDON_PARAMS="$XROAD_ADDON_PARAMS"
fi

# the final params
XROAD_SIGNER_PARAMS="$TEMP_SIGNER_PARAMS"
XROAD_ADDON_PARAMS="$TEMP_ADDON_PARAMS"

if [ -n "$JAVA_HOME" ]; then
  PATH="$JAVA_HOME/bin:$PATH"
  export JAVA_HOME
fi
